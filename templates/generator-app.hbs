<div class="vibe-scene-two-app">

    <div class="step-content">
        {{#if (eq step 1)}}
        <div class="step1-prompt-area">
            <textarea name="userPrompt" rows="10"
                placeholder="Describe the biome, interior/exterior, specific rooms, and overall vibe. E.g., &quot;A cozy interior of a fantasy tavern named The Prancing Pony, including a common room, kitchen, and cellar.&quot;">{{userPrompt}}</textarea>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" name="includeRoomLabels" {{#if includeRoomLabels}}checked{{/if}}>
                    Draw room names directly on the map image
                </label>
            </div>
            <div class="step1-actions">
                <button type="button" data-action="randomize" class="randomize-btn" title="Random scene concept">
                    <i class="fas fa-dice"></i>
                </button>
                <button type="button" data-action="next" class="generate-btn">
                    <i class="fas fa-magic"></i> Generate Layout
                </button>
            </div>
        </div>
        {{/if}}

        {{#if (eq step 2)}}
        <div class="step2-layout">
            <div class="svg-panel" id="svg-container">
                {{{svg}}}
            </div>
            <div class="controls-panel">
                <h3>SVG Layout Preview</h3>
                <p class="notes">This abstract layout will guide the image generation. Review the room
                    placement before rendering.</p>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" name="useInpaintingPipeline" {{#if useInpaintingPipeline}}checked{{/if}}>
                        Experimental: Inpainting Pipeline (Room-by-Room)
                    </label>
                </div>
                <div class="action-buttons">
                    <button type="button" data-action="next" class="render-btn">
                        <i class="fas fa-image"></i> Render Map
                    </button>
                    <button type="button" data-action="back" class="back-btn">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
            </div>
        </div>
        {{/if}}

        {{#if (eq step 3)}}
        <div class="image-review" style="text-align: center; display: flex; flex-direction: column;">
            <h3>Final Rendered Map</h3>
            <img src="data:image/jpeg;base64,{{imageBuffer}}"
                style="max-width: 100%; height: 60vh; object-fit: contain; border-radius: 5px; border: 1px solid #444; box-shadow: 0 4px 8px rgba(0,0,0,0.5); margin-bottom: 15px;">
            <p class="notes" style="margin-top: auto;">If approved, this will be imported as a Scene with walls and
                lighting.</p>
        </div>
        {{/if}}
    </div>

    {{#if (eq step 3)}}
    <footer class="sheet-footer flexrow" style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
        <button type="button" data-action="back"><i class="fas fa-arrow-left"></i> Back</button>
        <button type="button" data-action="finish"><i class="fas fa-check"></i> Create Scene</button>
    </footer>
    {{/if}}
</div>